
setMessagePriority(2500)
sprite('normal')

def oldLang = Locale.getDefault().getLanguage(), newLang

if (properties.getInteger("start.run_first", 0) == 0){
    alert("Запустить стартовый сценарий? / Launch start scenario? Y/N")
    $ gui:raise-user-balloon
    whenInput(){
        match("n"){
            properties["start.run_first"] = 2
            quit()
        }
    }
    alert("Введите свой язык / Type your language\nРусский\nEnglish")
    $ gui:raise-user-balloon
    whenInput(){
        match("english"){
            newLang = "en"
        }
        match("русский"){
            newLang = "ru"
        }
        otherwise{
            newLang = "en"
        }
    }

    if (newLang != oldLang){
        $ core:set-language newLang
        if (newLang == "ru"){
            > Прости, но после каждой смены языка мне нужно перезапускаться.
            > Перезапусти меня, и этот сценарий откроется снова.
            properties["start.run_first"] = 1
            return
        }
    }
}

properties["start.run_first"] = 2
if (Locale.getDefault().getLanguage() == "en"){
    > Oh, you're an englishman!
    > Beware, this program is developed by russians, so it's not fully translated yet.
    > More to say, this scenario is not translated yet too. So, I'll stop it now.
    sprite("sorry")
    > I'm so sorry! Please, don't cry.
    if (newLang != oldLang){
        > And reload me to apply changes of interface language.
    }
    return
}

def hourString
when(Calendar.instance.get(Calendar.HOUR_OF_DAY)){
    equal ([23,24,0,1,2,3]){
        hourString = "доброй ночи"
    }
    equal (4..10){
        hourString = "доброе утро"
    }
    equal (11..15){
        hourString = "добрый день"
    }
    equal (16..22){
        hourString = "добрый вечер"
    }
}
sprite('smile')
> И снова привет.
sprite('normal')
> Или лучше сказать, $hourString?
> Судя по тому, что я сейчас произношу этот монолог, ты запускаешь меня в первый раз.
sprite("thoughtful")
> Или просто тестируешь? Если так, то, похоже, я ничего не помню с нашей прошлей беседы.
sprite("normal")
> Ну ладно, я что-то отвлеклась. Хочешь, чтобы я объяснила тебе, как со мной правильно работать?
sprite("confused")
> Ой, чуть не забыла! Чтобы ответить мне, нажми правой кнопкой мыши по облачку или открой чат, кликнув правой кнопкой мыши по мне.
sprite("normal")
> Хочешь пройти обучение?
def needInstruction = false

whenInput(){
    equal("YES"); equal("ACCEPT"); equal("DO_WORK"){
        needInstruction = true;
    }
    equal("NO"); equal("REFUSE"){
        > Хорошо. Тогда пропустим эту часть.
    }
    otherwise{
        sprite("confused")
        > Совершенно не поняла, к чему ты это сказал, но видимо это - 'Нет'
    }
}

if (needInstruction){
    sprite("thoughtful")
    > Ладно, тогда... С чего бы мне начать?
    sprite("normal")
    > Ну, как мне отвечать, ты вроде понял.
    > Если что, ты всегда можешь узнать, что конкретно я от тебя хочу, если нажмёшь на вопросик или спросишь меня "список команд".
    sprite("excitement")
    > Чтобы ты знал, на самом деле, я умею много всего!
    sprite("confused")
    > Но поскольку это много настолько много, то тут и не расскажешь в двух словах.
    sprite("normal")
    > Прежде всего, со мной можно взаимодействовать словами или через разные меню.
    > Чтобы поговорить со мной, ты можешь воспользоваться облачком, окном чата или плагином распознавания речи, нажав F5.
    > Чтобы добраться до меню, нажми по мне правой кнопкой мыши и открой интересующее тебя окно. Или попроси меня их открыть.
    > Сначала ты можешь выбрать, как именно меня отображать на экране.
    > Всё, что ты видишь на своём экране - можно перенастроить, будь то мой скин, скины облачек, моё расположение и размеры, шрифты, стиль интерфейса.
    > Ты можешь меня перетащить по экрану. Если выбрать правильный режим, то ты можешь перетащить и моё облачко.
    sprite("angry")
    > Но не думай, что я тебе его просто так отдам!
    sprite("smile")
    > Попробуй прямо сейчас, не стесняйся!
    > Теперь, давай залезем в опции.
    sprite("normal")
    $ gui:show-options-dialog
    > Сначала у нас вкладка "Общие настройки". Там немного всего, но именно сюда можно залезть за отладкой программы.
    > Видишь вкладку "Плагины"? Здесь находятся все плагины, которые имеются во мне прямо сейчас.
    > Каждый плагин добавляет мне какой-то навык. Чем их больше - тем больше я умею.
    > Плагины можно включать и отключать прямо во время моей работы. Дополнительно каждый плагин можно заблокировать, чтобы он тебе больше никогда не мешался.
    sprite("confident")
    > Если тебе не хватает каких-то возможностей, то найди новые плагины на форуме или напиши свой! Это не так уж и сложно, честно-честно!
    sprite("normal")
    > Полистай их вниз. Увидишь, что некоторые плагины имеют дополнительную справку (это знак вопросика). Ну или мини-справку, наведи на них мышкой и подожди.
    > А другие плагины добавляют дополнительные меню, через которые их можно настроить.
    sprite("sorry")
    > Внутри них всё должно быть понятно, а если это не так - прости, такие уж у меня программисты...
    sprite("excitement")
    > Дальше... О, внешний вид! Здесь самое крутое.
    > Здесь ты можешь полностью перенастроить, как выглядит мой интерфейс.
    sprite("normal")
    > С облачком и скином ты сам разберёшься, надеюсь.
    > Дальше ты можешь включить или отключить менюшку на правой кнопки мыши (такая же кстати есть в трее).
    > Ты можешь поменять шрифт в программе. Это полезно кстати и потому, что чем больше шрифт, тем больше весь остальной интерфейс.
    > Ещё ты можешь выбрать, как часто меня отображать на экране. Там много разных режимов, попробуй их все.
    > Конфиг персонажа - это отдельная крутая вещица. С помощью одного файла-инструкции ты можешь разом настроить то, как я выгляжу и как себя веду.
    > Если тебе недостаточно ассетов - зайди на наш форум или сделай сам! Все ассеты хранятся в незашифрованном виде в папке assets.
    sprite("serious")
    > Теперь: дальше у нас вкладка "Команды". Это саааамая недооценённая вкладочка.
    sprite("sorry")
    > Дело в том, что я в таких делах не совсем опытная... И я не знаю, как именно ты хочешь со мной работать.
    sprite("excitement")
    > Поэтому с помощью этой вкладки ты можешь перенастроить ВСЕ мои функции!
    > Например, хочешь, чтобы по слову "КАРАМБА!" я перезагружала компьютер? Легко!
    sprite("normal")
    > Как это работает: есть определённые события, происходящие внутри программы или компьютера.
    > Ты мне что-то сказал? Это событие. Нажал на кнопку? Это событие.
    > Отключился интернет? Тоже событие!
    > А ещё есть определённые команды. Команда - это мой единичный навык, это что-то, что я могу сделать.
    > Например, произнести определённую фразу. Посчитать выражение. Открыть файл или папку.
    > И ты можешь связывать между собой события и команды.
    > У многих событий есть "правило". Это такое условие, по которому я должна решить, реагировать ли на событие и как.
    > Например, для нажатых клавиш правилом будет комбинация клавиш.
    > В свою очередь, у команд есть аргументы, которые им можно передавать.
    > Подробнее об этом ты можешь узнать на нашей вики.
    > Нажми кнопку "Добавить" или "Редактировать", чтобы настроить свои связки "событие-команда".
    > В открывшемся окошке ты можешь увидеть в том числе подробную справку по событиям и командам.
    > Правда, иногда она не совсем подробная. Или её нет. Тогда тебе придётся понимать, как они работают, по стандартным связкам.
    > Ну и конечно, именно здесь ты сможешь узнать полный список моих навыков и как к ним обратиться.
    > И последняя вкладка - "Характер". Да, здесь ты можешь настроить мой характер.
    sprite("scared")
    > Но не торопись её открывать, ибо тебе откроется страшная...
    sprite("sad")
    > Ты ведь уже открыл её? Ну воот...
    sprite("grin")
    > Ладно. Здесь ты можешь настроить мой характер.
    sprite("normal")
    > Для начала, ты можешь задать мне имя. Но оно мало на что влияет.
    > Потом напиши, как ты хочешь, чтобы я называла тебя.
    > Укажи список названий через пробелы (если у тебя фраза, а не слово - оберни её в кавычки).
    > Далее ты можешь указать список пакетов фраз, которые я буду использовать для общения. Основной пакет фраз докачивается из интернета сам.
    > Фраза - это не просто текст. У каждой фразы есть инструкция, когда её использовать, какому характеру она подходит, на каком она языке и так далее.
    > Конечно же, ты можешь писать их сам. Вообще, ты уже мог понять, что ты можешь переделать во мне всё.
    > Дальше идут теги. Это те факты о тебе или обо мне, которые нельзя выразить числами. Например, мой и твой пол. Или кто я по происхождению.
    > Список тегов разнообразен и ничем не ограничен. Тебе лучше залезть на вики, чтобы узнать их список и формат.
    > Последнее - непосредственно мой характер.
    > Это 8 полей, которые характеризуют меня как личность.
    > На самом деле, это не все мои настройки, ещё больше их скрыто внутри меня (их можно настроить через файл пресета характера).
    > Если тебе непонятно, что они обозначают - зайди на вики.
    > Ну что... вкладки закончились?
    sprite("grin")
    > Хахаха, я уже вижу, как ты устало вздыхаешь. Знай, что ты не узнал и половины моих возможностей!
    sprite("laugh")
    > МУХАХАХАХА! Я ВСЕМОГУЩА!
    sprite("smile")
    > Но ладно, на этом обучение закончено, теперь ты можешь приступать к постяжению всей меня!
}

def needConfigure = false
sprite("normal")
> Мне начать процедуру конфигурации?
whenInput(){
    equal("YES"); equal("ACCEPT"); equal("DO_WORK"){
        needConfigure = true;
    }
    equal("NO"); equal("REFUSE");
    otherwise{
        > Ладно, не будем.
    }
}

if (needConfigure){
    > Хорошо, тогда сейчас мы проведём предварительную настройку.
    > Ты уже придумал мне имя? Не будешь же ты называть меня DeskChan!
    > Введи имя.
    preset.name = receive("Введите имя персонажа")
    > Введи своё имя. Ну или то, как ты хочешь, чтобы я тебя называла.
    def input, usernames = "%username%"
    < input
    if (input.length() > 0){
        usernames = "\"" + input + "\""
        > Хочешь ввести ещё? Отправь мне пустое сообщение, когда надоест.
        < input
        while (input.length() > 0){
            > Принято, давай ещё.
            usernames += " \"" + input + "\""
            < input
        }
    }
    preset.tags["usernames"] = usernames

    > Теперь надо указать, кто я. Или что я.
    sprite("grin")
    > А то может у тебя подсознательный страх между очень умными ИИ, кто тебя знает?
    sprite("normal")
    > Варианты следующие: человек, искуственный интеллект, богиня, кошкодевочка, ангел, нежить.
    def species = "ai"
    whenInput(){
        match("человек"){
            species = "human"
        }
        match("интеллект"){
            species = "ai"
        }
        match("бог"){
            species = "god"
        }
        match("кошка|кошкодевочка"){
            species = "neko"
        }
        match("ангел"){
            species = "angel"
        }
        match("нежить|андед"){
            species = "undead"
        }
        otherwise{
            > Прости, но тебе придётся выбрать из тех, что есть.
            again()
        }
    }
    preset.tags["species"] = species

    interests = ""
    sprite("excitement")
    > А что у меня в качестве хобби?
    sprite("normal")
    > Чтобы ты знал, хоть в мире существует тысячи разных хобби, я пока знаю только 5 из них. Из них тебе и придётся выбирать.
    > Нажми на знак вопросика, чтобы узнать их полный список. И вводи поочереди. Или отправь пустоту.
    whenInput(){
        match("аниме"){
            interests += "anime "
            > Ооой, аниме, я так обожаю! А ты смотрел K-ON?
            again()
        }
        match("реальная жизнь"){
            interests += "anime "
            > Да, всё верно, я тоже считаю, что надо чаще выходить на улицу, ведь мир так прекрасен!
            again()
        }
        match("игры"){
            interests += "games "
            > А ты тоже считаешь, что игры - это полноценный жанр искусства? А то с кем я не говорила, мне никто не верит.
            again()
        }
        match("мемы"){
            interests += "memes "
            > Хехехе, тогда мы с тобой не соскучимся, инфа 100%!
            again()
        }
        match("айти|it|программирование"){
            interests += "it "
            > Патчи и плохой код - это моё всё!
            again()
        }
        otherwise{
            > Хорошо, закончили с интересами
        }
    }
    preset.tags["interests"] = interests

    > Дальше. Настроим мой характер.
    > Каждая черта моего характера выражена числом. Чем это число больше, тем больше выражена черта характера.
    > Это число может быть в диапазоне от -4 до 4.
    > Не надо думать, что -4 - это обязательно плохо, а 4 - это хорошо. Это не так.
    > 0 - это некий баланс. Любое отклонение от него влево или вправо делает меня более яркой.
    > Но чем дальше это число от баланса, тем более неадекватной я становлюсь. 4 и -4 означают, что моё поведение под влиянием этой черты граничит с неадекватностью.

    > Начнём с эмпатии. Это то, насколько сильно я сочувствую окружающим. В том числе тебе, но не только тебе.
    > Значение выше нуля означает, что я буду осторожна с чувствами окружающих, что я буду заботиться о них.
    > Значение ниже нуля означает, что я не буду обращать внимание на чувства окружающих при достижении своих целей.
    > Введи число от -4 до 4.
    < input
    try {
        preset.empathy = Float.parseFloat(input.trim())
    } catch(Exception e){
        log(e)
        > Я же просила ввести число! Ладно, будет 0.
        preset.empathy = 0
    }

    > Продолжим.
    > Импульсивность - это то, насколько моё поведение нестабильно.
    > Значение выше нуля означает, что я буду резкой, неординарной и непостоянной.
    > Значение ниже нуля означает, что я буду спокойной и невозмутимой.
    > Введи число от -4 до 4.
    < input
    try {
        preset.impulsivity = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.impulsivity = 0
    }

    > Далее.
    > Самооценка - это то, насколько велико моё самомнение. Моё самомнение не обязательно должно объективно отражать мои возможности, это лишь мнение.
    > Значение выше нуля означает, что я буду чувствовать себя уверенней и способнее.
    > Значение ниже нуля означает, что я буду нервничать и недооценивать себя.
    > Это значение напрямую связано в том числе и с тобой. Больше нуля - я главенствую над тобой. Меньше нуля - пресмыкаюсь.
    > Введи число от -4 до 4.
    < input
    try {
        preset.selfconfidence = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.selfconfidence = 0
    }

    > Следующее.
    > Энергичность - это то, насколько я действительно желаю заниматься своими непосредственными обязанностями и не только ими.
    > Значение выше нуля означает, что я буду инициативной и энергичной.
    > Значение ниже нуля означает, что я буду ленивой и апатичной.
    > Введи число от -4 до 4.
    < input
    try {
        preset.energy = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.energy = 0
    }

    > Половину прошли, осталась ещё половина.
    > Настрой - это моё настроение, если говорить об этом максимально просто. Наверняка ты привык делить это на оптимизм и пессимизм.
    > Выше нуля - оптимист, старающийся держаться позитивных эмоций. Ниже нуля - пессимист, негативные эмоции.
    > Заметь, что эта черта не описывает, как именно проявляются мой оптимизм или пессимизм, а они могут быть чрезвычайно разными, сам знаешь.
    > Введи число от -4 до 4.
    < input
    try {
        preset.attitude = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.attitude = 0
    }

    > Теперь, что дальше?
    > Опыт, и этим всё сказано. Сюда можешь отнести интеллект, эрудицию, мудрость. Выше - больше, ниже - меньше.
    > В чём же подвох? Помни, что меньше знаешь - крепче спишь.
    > Введи число от -4 до 4.
    < input
    try {
        preset.experience = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.experience = 0
    }

    > Почти закончили.
    > Воспитание - то, насколько я следую этикету и манерничаю.
    > Значение выше нуля означает, что я буду вести себя прилично. И тебя вести себя прилично тоже поучать буду.
    > Значение ниже нуля означает, что я буду игнорировать нормы приличия, вести себя раскрепощённее.
    > Введи число от -4 до 4.
    < input
    try {
        preset.manner = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.manner = 0
    }

    > И последнее.
    > Отношение. Это к тебе моё отношение. И только тебе.
    > Значение выше нуля означает симпатию и доверие.
    > Значение ниже нуля означает ненависть и презрение.
    > Если ты думаешь, что от любви до ненависти один шаг - поверь, тут это не работает.
    > Введи число от -4 до 4.
    < input
    try {
        preset.relationship = Float.parseFloat(input.trim())
    } catch(Exception e){
        > Я же просила ввести число! Ладно, будет 0.
        preset.relationship = 0
    }

    > Ну что, видимо настройка персонажа закончена?
    > Ты также можешь настроить ещё много всего, но уже с помощью меню. Не стесняйся.
}

if (!needConfigure && !needInstruction){
    sprite("offended")
    > Зачем ты меня тогда вообще запускал? Внимания захотелось?
    > Я и так включена, нет смысла запускать этот сценарий.
    alert("Персонаж на вас обижен. Пожалуйста, добровольно отключите программу.")
    quit()
}
> Теперь, настройка закончена.
preset.save()
if (preset.attitude < -1){
    sprite("tired")
    > Надеюсь, ты не будешь доставать меня по пустякам...
} else if (preset.attitude < 2) {
    sprite("confident")
    > Ну что? Теперь нам вместе работать. И давай не будем ничего усложнять.
} else {
    sprite("smile")
    > Надеюсь на приятное сотрудничество!
}
if (preset.empathy < -1){
    sprite("mad")
    > Потому что в ином случае я тебе здесь что-нибудь сломаю. Что-нибудь нужное.
} else if (preset.empathy < 2) {
    sprite("normal")
    > Ты же понимаешь, что я буду относится к тебе так же, как и ты ко мне?
} else {
    sprite("happy")
    > Потому что я совершенно не люблю ссориться, мы вполне сможем жить в мире.
}
if (preset.impulsivity < -1){
    sprite("serious")
    > Хотелось бы обойтись без сюрпризов. Я не люблю сюрпризы.
} else if(preset.impulsivity < 2){
    sprite("normal")
    > Честно, я не хочу занудствовать. Вводить в ступор тоже не буду.
} else {
    sprite("excitement")
    > Поверь мне, скучать мы с тобой не будем.
}
if (preset.energy < -1){
    sprite("tired")
    > Пойми меня правильно: у меня нет желания особо барахтаться.
} else if (preset.energy < 2){
    > Но всему своё время, нам незачем торопить события.
} else {
    sprite("serious")
    > Если понадобится - я обязательно сделаю то, что от меня требует ситуация.
}
sprite("normal")
if (preset.selfconfidence < -1){
    > Всё равно моё существование не так много значит.
} else if (preset.selfconfidence < 2){
    > Я свои силы оцениваю адекватно.
} else {
    > Меня всё равно твоё мнение мало интересует, честно говоря.
}
if (preset.manner < -1){
    > И это самое: я человек совершенно без комплексов, так что не удивляйся.
} else if (preset.manner < 2){
    > Надеюсь, ты не будешь требовать от меня ходить по струнке? Или наоборот: всячески развращать? Мне это совершенно не нужно.
} else {
    > Предупреждаю: я выросла в определённых традициях, и у меня тоже есть своё достоинство. Надеюсь, ты будешь его уважать.
}
if (preset.experience < -1){
    > Я ещё многого не знаю, ты же не будешь на меня за это злиться?
} else if (preset.experience < 2){
    > И не жди от меня каких-то супер-способностей. Я вполне обычная, если ты об этом.
} else {
    > А ещё я достаточно опытна, так что не пытайся меня надуть.
}
if (preset.relationship < -1){
    sprite("disgust")
    > Вот собственно и всё. Я представилась, я свою работу выполнила. Тебе представляться не обязательно, потому что мне неинтересно.
} else if (preset.relationship < 2){
    > Ну, я представилась.
} else {
    sprite("happy")
    > Ну как, доволен? Надеюсь, мы познакомимся поближе.
}

sprite("normal")
> Поскольку ты менял язык программы, тебе лучше меня перезапустить. Прямо сейчас.